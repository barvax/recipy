<!DOCTYPE html>
<html>
<head>
  <style>
    table {
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid black;
      padding: 5px;
    }
    .popup-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .popup {
      background-color: #fff;
      padding: 20px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <label for="columnInput">Number of columns:</label>
  <input type="number" id="columnInput">
  <button onclick="createTable()">Create Table</button>

  <div id="tablesContainer"></div>

  <div id="popupContainer" class="popup-container" style="display: none;">
    <div class="popup">
      <h3>Select Material:</h3>
      <select id="materialDropdown"></select>
      <button onclick="addRowFromPopup()">Add Row</button>
    </div>
  </div>

  <div id="detailsPopupContainer" class="popup-container" style="display: none;">
    <div class="popup">
      <h3>Material Details:</h3>
      <p id="materialDetails"></p>
      <button onclick="closeDetailsPopup()">Close</button>
    </div>
  </div>

  <script>
    var materials = [
      { name: 'Material 1', color: 'Red', price: '$10' },
      { name: 'Material 2', color: 'Blue', price: '$15' },
      { name: 'Material 3', color: 'Green', price: '$20' },
    ];

    var tableCount = 0;

    function createTable() {
      var columnCount = document.getElementById("columnInput").value;

      var table = document.createElement('table');
      table.id = "myTable_" + tableCount;

      var tableContainer = document.createElement('div');
      tableContainer.appendChild(table);

      var columnInput = document.getElementById("columnInput");

      var thead = document.createElement('thead');
      var tbody = document.createElement('tbody');

      var headerRow = document.createElement('tr');

      var th = document.createElement('th');
      th.textContent = 'Material';
      headerRow.appendChild(th);

      for (var i = 2; i <= columnCount; i++) {
        var th = document.createElement('th');
        var input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'Column ' + i;
        th.appendChild(input);
        th.setAttribute('data-value', 'column' + i);
        headerRow.appendChild(th);
      }
      thead.appendChild(headerRow);

      table.appendChild(thead);
      table.appendChild(tbody);

      // Enable drag and drop for the table columns
      enableDragAndDrop(table);

      // Show the "Add Row" button
      var addButton = document.createElement('button');
      addButton.textContent = "Add Row";
      addButton.onclick = function() { openPopup(table.id); };
      tableContainer.appendChild(addButton);

      var tablesContainer = document.getElementById("tablesContainer");
      tablesContainer.appendChild(tableContainer);

      tableCount++;
    }

    function openPopup(tableId) {
      var popupContainer = document.getElementById("popupContainer");
      popupContainer.style.display = "flex";

      // Populate the material dropdown in the popup
      var materialDropdown = document.getElementById("materialDropdown");
      materialDropdown.innerHTML = "";
      populateMaterialDropdown(materialDropdown);
      materialDropdown.setAttribute("data-table", tableId);
    }

    function closePopup() {
      var popupContainer = document.getElementById("popupContainer");
      popupContainer.style.display = "none";
    }

    function addRowFromPopup() {
      var materialDropdown = document.getElementById("materialDropdown");
      var selectedMaterial = materialDropdown.value;
      var tableId = materialDropdown.getAttribute("data-table");

      if (selectedMaterial) {
        addRow(tableId, selectedMaterial);
        closePopup();
      }
    }

    function addRow(tableId, selectedMaterial) {
      var table = document.getElementById(tableId);
      var tbody = table.querySelector('tbody');

      var row = document.createElement('tr');

      var columnCount = document.getElementById("columnInput").value;

      // Create the first cell with the material name
      var materialCell = document.createElement('td');
      materialCell.textContent = selectedMaterial;
      materialCell.setAttribute('data-material', selectedMaterial);
      row.appendChild(materialCell);

      // Create the remaining cells with input fields
      for (var i = 1; i < columnCount; i++) {
        var cell = document.createElement('td');
        var input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'Row ' + (table.rows.length + 1) + ', Column ' + (i + 1);
        cell.appendChild(input);
        row.appendChild(cell);
      }

      tbody.appendChild(row);
    }

    function populateMaterialDropdown(select) {
      for (var i = 0; i < materials.length; i++) {
        var option = document.createElement('option');
        option.value = materials[i].name;
        option.textContent = materials[i].name;
        select.appendChild(option);
      }
    }

    function enableDragAndDrop(table) {
      var columns = table.querySelectorAll('th[data-value]');

      columns.forEach(function(column) {
        column.draggable = true;
        column.addEventListener('dragstart', handleDragStart, false);
        column.addEventListener('dragenter', handleDragEnter, false);
        column.addEventListener('dragover', handleDragOver, false);
        column.addEventListener('dragleave', handleDragLeave, false);
        column.addEventListener('drop', handleDrop, false);
        column.addEventListener('dragend', handleDragEnd, false);
      });
    }

    var dragSrcElement = null;

    function handleDragStart(e) {
      dragSrcElement = this;

      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.innerHTML);

      this.classList.add('dragging');
    }

    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }

      e.dataTransfer.dropEffect = 'move';

      return false;
    }

    function handleDragEnter(e) {
      this.classList.add('over');
    }

    function handleDragLeave(e) {
      this.classList.remove('over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) {
        e.stopPropagation();
      }

      if (dragSrcElement !== this) {
        swapColumns(dragSrcElement, this);
      }

      return false;
    }

    function handleDragEnd(e) {
      this.classList.remove('dragging');
      var columns = document.querySelectorAll('th');
      columns.forEach(function(column) {
        column.classList.remove('over');
      });
    }

    function swapColumns(srcColumn, destColumn) {
  var srcIndex = srcColumn.cellIndex;
  var destIndex = destColumn.cellIndex;

  var table = srcColumn.closest('table');
  var rows = table.rows;

  for (var i = 0; i < rows.length; i++) {
    var srcCell = rows[i].cells[srcIndex];
    var destCell = rows[i].cells[destIndex];

    var srcInput = srcCell.querySelector('input');
    var destInput = destCell.querySelector('input');

    var srcValue = srcInput.value;
    var destValue = destInput.value;

    srcInput.value = destValue;
    destInput.value = srcValue;

    // Swap the data values of the cells
    var srcDataValue = srcCell.getAttribute('data-value');
    var destDataValue = destCell.getAttribute('data-value');
    srcCell.setAttribute('data-value', destDataValue);
    destCell.setAttribute('data-value', srcDataValue);
  }
}




    function openDetailsPopup(material) {
      var detailsPopupContainer = document.getElementById("detailsPopupContainer");
      detailsPopupContainer.style.display = "flex";

      var materialDetails = document.getElementById("materialDetails");
      materialDetails.textContent = JSON.stringify(material);
    }

    function closeDetailsPopup() {
      var detailsPopupContainer = document.getElementById("detailsPopupContainer");
      detailsPopupContainer.style.display = "none";
    }

    // Wait for the document to load
    document.addEventListener("DOMContentLoaded", function() {
      // Add event listener for cell click
      var tablesContainer = document.getElementById("tablesContainer");
      tablesContainer.addEventListener("click", function(event) {
        var cell = event.target;
        if (cell.tagName === "TD" && cell.hasAttribute("data-material")) {
          var material = cell.getAttribute("data-material");
          openDetailsPopup(material);
        }
      });
    });
  </script>
</body>
</html>
